<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access | Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            black: '#0F0F0F',
                            dark: '#141414',
                            surface: '#1F1F1F',
                            border: 'rgba(255, 255, 255, 0.1)'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #0F0F0F;
            color: #e5e5e5;
            -webkit-font-smoothing: antialiased;
        }

        /* Glassmorphism */
        .glass-panel {
            background: rgba(30, 30, 30, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        .input-dark {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }
        .input-dark:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.05);
        }

        /* Grid Texture */
        .bg-grid {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-grid overflow-hidden relative">

    <!-- Ambient Background Light -->
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-white/5 rounded-full blur-3xl pointer-events-none"></div>

    <!-- Login Container -->
    <div id="login-container" class="flex-grow flex items-center justify-center p-6 relative z-10">
        <div class="w-full max-w-md glass-panel p-10 rounded-2xl animate-fade-in">
            
            <!-- Header -->
            <div class="text-center mb-10">
                <span class="text-xs tracking-[0.3em] uppercase text-gray-500 mb-4 block">System Access</span>
                <h2 class="text-4xl font-light">
                    Welcome <span class="font-serif italic text-gray-400">Back</span>
                </h2>
            </div>

            <form id="login-form" class="space-y-6">
                <!-- Hidden Email Field with Default Value -->
                <div class="hidden">
                    <label for="email" class="block text-xs uppercase tracking-widest text-gray-500 mb-2">Email Identity</label>
                    <input type="email" id="email" class="input-dark w-full rounded-lg px-4 py-3 text-sm" value="armanalam12386@gmail.com" required>
                </div>
                
                <div>
                    <label for="password" class="block text-xs uppercase tracking-widest text-gray-500 mb-2">Passkey</label>
                    <input type="password" id="password" class="input-dark w-full rounded-lg px-4 py-3 text-sm" placeholder="••••••••" required>
                </div>
                
                <p id="error-message" class="text-rose-400 text-xs font-mono text-center hidden bg-rose-500/10 py-2 rounded border border-rose-500/20"></p>
                
                <button type="submit" class="w-full bg-white hover:bg-gray-200 text-black font-medium py-3 px-4 rounded-lg transition-all duration-300 uppercase text-xs tracking-[0.2em] mt-4">
                    Authenticate
                </button>
            </form>

            <div class="mt-8 text-center">
                <a href="#" class="text-xs text-gray-600 hover:text-white transition-colors uppercase tracking-wider">Forgot Credentials?</a>
            </div>
        </div>
    </div>
    
    <script type="module">
        // --- Firebase Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        
        // --- Firebase Configuration (Project 11) ---
        const firebaseConfig = {
          apiKey: "AIzaSyA-89SA71JDCDbCE3PjIdWHZHJs0qN-1Pc",
          authDomain: "project---11.firebaseapp.com",
          projectId: "project---11",
          storageBucket: "project---11.firebasestorage.app",
          messagingSenderId: "958555644000",
          appId: "1:958555644000:web:405109efd428b349f62305",
          measurementId: "G-DPGZ8CS3SP"
        };
        
        // --- Initialize Firebase ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        // --- Session Configuration ---
        const SESSION_TIMEOUT_MS = 11 * 60 * 60 * 1000; // 11 Hours in milliseconds

        // --- Redirect if already logged in (Check for Expiration) ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const lastLogin = localStorage.getItem('last_login');
                const now = Date.now();
                
                // Check if we have a valid timestamp and it's within 11 hours
                if (lastLogin && (now - parseInt(lastLogin) < SESSION_TIMEOUT_MS)) {
                    // Valid Session: Redirect to dashboard (now located at login.html)
                    document.body.style.opacity = '0';
                    document.body.style.transition = 'opacity 0.5s ease';
                    setTimeout(() => {
                        window.location.href = 'login.html'; 
                    }, 500);
                } else {
                    // Session Expired or No Timestamp found: Force Logout
                    console.warn("Session expired or invalid timestamp. Logging out.");
                    await signOut(auth);
                    localStorage.removeItem('last_login'); // Clear invalid timestamp
                    
                    const errorMessage = document.getElementById('error-message');
                    errorMessage.textContent = "Session expired. Please verify credentials.";
                    errorMessage.classList.remove('hidden');
                }
            }
        });

        // --- DOM Elements ---
        const loginForm = document.getElementById('login-form');
        const errorMessage = document.getElementById('error-message');
        const submitBtn = loginForm.querySelector('button');

        // --- Login Logic ---
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // UI Feedback
            errorMessage.classList.add('hidden');
            const originalBtnText = submitBtn.innerText;
            submitBtn.innerText = "VERIFYING...";
            submitBtn.classList.add('opacity-70', 'cursor-not-allowed');
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            // Set session time BEFORE auth request to prevent race condition
            localStorage.setItem('last_login', Date.now());

            try {
                await signInWithEmailAndPassword(auth, email, password);
                // onAuthStateChanged will handle the redirect
            } catch (error) {
                // If failed, clear the speculative timestamp
                localStorage.removeItem('last_login');

                // Reset Button
                submitBtn.innerText = originalBtnText;
                submitBtn.classList.remove('opacity-70', 'cursor-not-allowed');

                // Error Handling
                let friendlyMessage = "Authentication failed.";
                console.error("Auth Error:", error.code, error.message);

                if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                   friendlyMessage = "Invalid identity or passkey.";
                } else if (error.code === 'auth/invalid-email') {
                    friendlyMessage = "Invalid email format.";
                } else if (error.code === 'auth/too-many-requests') {
                    friendlyMessage = "Too many attempts. Try again later.";
                }
                
                errorMessage.textContent = friendlyMessage;
                errorMessage.classList.remove('hidden');
                
                // Shake animation for error
                const panel = document.querySelector('.glass-panel');
                panel.classList.add('animate-[shake_0.5s_ease-in-out]');
                setTimeout(() => panel.classList.remove('animate-[shake_0.5s_ease-in-out]'), 500);
            }
        });
    </script>
</body>
</html>
